@model IEnumerable<EmsWebApplication.Models.Ticket>
@using System.Text.Json;

@{
    ViewBag.Title = "Index";
    List<int> shoppingCart = new List<int>(); // Initialize an empty shopping cart

    // Serialize shoppingCart on the server side
    var cartJson = System.Text.Json.JsonSerializer.Serialize(shoppingCart);
    ViewBag.CartJson = cartJson;
}

<h2>Buy Your Ticket Now!</h2>

<canvas id="TicketsBackground"></canvas>

@foreach (var item in Model)
{
    <div class="ticket">
        <h3>@item.Event.EventName</h3>
        <p><strong>Date:</strong> @item.Event.EventDate</p>
        <p><strong>Venue:</strong> @item.Event.EventVenue</p>
        <p><strong>Description:</strong> @item.Event.EventDescription</p>
        <p><strong>Price:</strong> $@item.Event.EventPrice</p>

        <!-- Button to add the ticket to the cart -->
        <button class="addToCartButton" data-ticket-id="@item.TicketId">Add to Cart</button>
    </div>
}

<p>
    @Html.ActionLink("Create New", "Create")
</p>

<div>
    <span>Cart Items: <span id="cartItemCount">0</span></span>
    <button id="checkoutButton">Checkout</button>
</div>

<style>

    * {
        font-family: Courier New, Courier, monospace;
    }

    .addToCartButton {
        border-color: dimgrey;
        border-radius: 12px;
        color: black;
    }

        .addToCartButton:hover {
            background-color: dimgray;
            color: white;
        }

    .ticket {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px;
        border-radius: 12px;
        background-color: aliceblue;
        opacity: 0.6
    }

        .ticket:hover {
            transform: scale(1.1);
            opacity: 0.8;
            box-shadow: 0 0 20px rgb(111, 255, 23);
        }

    a {
        text-decoration: none;
        color: white;
    }

    canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("https://cdn.wallpapersafari.com/41/48/0xSLbK.jpg");
        background-repeat: no-repeat;
        background-position-y: 100%;
        background-position: center;
        background-size: cover;
        z-index: -1;
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        var cart = @Html.Raw(ViewBag.CartJson); // Retrieve serialized shopping cart from ViewBag

        // Function to update the UI and shopping cart data
        function updateCartUI() {
            // Update the UI to reflect the number of items in the cart
            $("#cartItemCount").text(cart.length);
        }

        // Function to display the cart items when the "Checkout" button is clicked
        function displayCartItems() {
            if (cart.length > 0) {
                var itemsList = "Items in your cart:\n";
                for (var i = 0; i < cart.length; i++) {
                    itemsList += "- Ticket ID " + cart[i] + "\n";
                }
                alert(itemsList);
            } else {
                alert("Your cart is empty. Add items before checking out.");
            }
        }

        // Click event for "Add to Cart" buttons
        $(".addToCartButton").click(function () {
            var ticketId = $(this).data("ticket-id");
            cart.push(ticketId);

            // Update the UI
            updateCartUI();

            alert("Ticket ID " + ticketId + " added to cart.");
        });

        // Handle checkout logic (e.g., display cart items)
        $("#checkoutButton").click(function () {
            displayCartItems();
        });

        // Call updateCartUI to initialize the UI when the page loads
        updateCartUI();
    });
</script>